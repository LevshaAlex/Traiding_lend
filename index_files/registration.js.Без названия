function simpleInputHandler(e,t){var r=utils.findElement(e);this[t+"DOM"]=r;var i=this;r.addEventListener("input",function(){i[t]=utils.trim(this.value),i.trigger("change",i)})}function simpleSetDOM(e,t){return null===this[e+"DOM"]?this:(this[e]=t,this[e+"DOM"].value=t,this)}function simpleSetter(e,t,r){if(void 0===e||0===e.length)throw new Error("Передан пустой аргумент для поля: "+r);this[t]=e}var utils={isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},trim:function(e,t){return t=t||"\\s+",e.replace(new RegExp("^"+t+"|"+t+"$","g"),"")},findElement:function(e){if(void 0===e)throw"Не передан селектор";var t;if(!(t=document.querySelector(e)))throw new Error('Элемент с селектором "'+e+'" не нейден');return t},findElements:function(e){if(void 0===e)throw new Error("Не передан селектор");var t=document.querySelectorAll(e);if(0===t.length)throw new Error('Элементы с селектором "'+e+'" не нейдены');return t},sendByFetch:function(e,t,r,i){fetch(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json; charset=UTF-8","X-Request-Type":"Api-Request","X-Request-Project":r},credentials:"include"}).then(function(e){return e.json()}).then(i).catch(function(e){console.log("Request failed",e)})},getLocale:function(){var e=null;return null===(e=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage?navigator.userLanguage:navigator.language)?e="en":e.length>2&&(e=e.substring(0,2)),e},getHostNames:function(){var e=window.location.hostname.split(".").reverse(),t={},r="olymptrade.com";return window.location.hostname.indexOf("localhost")>=0?t={API:"/v2/user/registration-by-password",PLATFORM:"https://"+r+"/",CDN:"https://static."+r+"/"}:(e.length<2&&(e=r.split(".").reverse()),t={API:"https://api."+(r=e[1]+"."+e[0])+"/v2/user/registration-by-password",PLATFORM:"https://"+r+"/",CDN:"https://static."+r+"/"},"olymptrade-id"===e[1]&&(t.CDN="https://official."+r+"/")),t}},Translation=function(e){var t=this;t._store=e||{},t.get=function(e,r){var i=r&&r.length?r:e;return void 0!==t._store[e]?t._store[e]:i},t.all=function(){return t._store}},eventMixin={on:function(e,t){this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push(t)},off:function(e,t){var r=this._eventHandlers&&this._eventHandlers[e];if(r)for(var i=0;i<r.length;i++)r[i]==t&&r.splice(i--,1)},trigger:function(e){if(this._eventHandlers&&this._eventHandlers[e])for(var t=this._eventHandlers[e],r=0;r<t.length;r++)t[r].apply(this,[].slice.call(arguments,1))}},ValueBuilder=function(e,t){this._language="ru",this._email="",this._password="",this._name="",this._surname="",this._phone="",this._currency="",this._timezone=(new Date).getTimezoneOffset()/60*-1,this._rules=!0,t===RegistrationModel.PROJECT_FX&&(this._project="FX"),this._additionalFields={},this._emailDOM=null,this._passwordDOM=null,this._nameDOM=null,this._surnameDOM=null,this._phoneDOM=null,this._currencyDOM=null,this._rulesDOM=null};ValueBuilder.prototype.addEmailInput=function(e){return simpleInputHandler.call(this,e,"_email"),this},ValueBuilder.prototype.addPasswordInput=function(e){return simpleInputHandler.call(this,e,"_password"),this},ValueBuilder.prototype.addNameInput=function(e){return simpleInputHandler.call(this,e,"_name"),this},ValueBuilder.prototype.addSurnameInput=function(e){return simpleInputHandler.call(this,e,"_surname"),this},ValueBuilder.prototype.addPhoneInput=function(e){return simpleInputHandler.call(this,e,"_phone"),this},ValueBuilder.prototype.addCurrencyInput=function(e){var t=utils.findElements(e);this._currencyDOM=t;for(var r=this,i=0;i<t.length;i++)t[i].checked&&(r._currency=t[i].value.toLowerCase()),t[i].addEventListener("change",function(){r._currency=this.value.toLowerCase(),r.trigger("change",r)});return r.currency||(r._currency=t[0].value.toLowerCase(),t[0].checked=!0),this},ValueBuilder.prototype.addRulesInput=function(e){var t=utils.findElement(e);this._rules=t.checked,this._rulesDOM=t;var r=this;return t.addEventListener("change",function(){r._rules=this.checked,r.trigger("change",r)}),this},ValueBuilder.prototype.setEmailDOM=function(e){return simpleSetDOM.call(this,"_email",e)},ValueBuilder.prototype.setPasswordDOM=function(e){return simpleSetDOM.call(this,"_password",e)},ValueBuilder.prototype.setNameDOM=function(e){return simpleSetDOM.call(this,"_name",e)},ValueBuilder.prototype.setSurnameDOM=function(e){return simpleSetDOM.call(this,"_surname",e)},ValueBuilder.prototype.setPhoneDOM=function(e){return simpleSetDOM.call(this,"_phone",e)},ValueBuilder.prototype.setCurrencyDOM=function(e){if(null===this._currencyDOM)return this;if(void 0===e||-1===["usd","rub","eur","brl"].indexOf(e))throw new Error("Передано неверное значение валюты");for(var t=0;t<this._currencyDOM.length;t++)this._currencyDOM[t].checked=!1,this._currencyDOM[t].value===e&&(this._currency=e,this._currencyDOM[t].checked=!0);return this},ValueBuilder.prototype.setRulesDOM=function(e){if(null===this._rulesDOM)return this;if("boolean"!=typeof e)throw new Error("Согласие должно быть boolean");return this._rules=e,this._rulesDOM.checked=e,this},ValueBuilder.prototype.setLanguage=function(e){return simpleSetter.call(this,e,"_language","язык"),this},ValueBuilder.prototype.setEmail=function(e){return simpleSetter.call(this,e,"_email","email"),this},ValueBuilder.prototype.setPassword=function(e){return simpleSetter.call(this,e,"_password","пароль"),this},ValueBuilder.prototype.setName=function(e){return simpleSetter.call(this,e,"_name","имя"),this},ValueBuilder.prototype.setSurname=function(e){return simpleSetter.call(this,e,"_surname","фамилия"),this},ValueBuilder.prototype.setPhone=function(e){return simpleSetter.call(this,e,"_phone","телефон"),this},ValueBuilder.prototype.setCurrency=function(e){if(void 0===e||-1===["usd","rub","eur","brl"].indexOf(e))throw new Error("Передано неверное значение валюты");return this._currency=e,this},ValueBuilder.prototype.setRules=function(e){if("boolean"!=typeof e)throw new Error("Согласие должно быть boolean");return this._rules=e,this};var forbiddenFields=["language","email","password","name","surname","phone","currency","timezone","rules","project"];ValueBuilder.prototype.addAdditionalField=function(e,t){if(-1!==forbiddenFields.indexOf(e))throw new Error('Поле "'+e+'" уже существует');return this._additionalFields[e]=t,this};var id=1,RegistrationModel=function(e,t,r){this._userLocale=r||utils.getLocale(),this._resultTranslate={};for(var i in translates){var n=translates[i];n[this._userLocale]?this._resultTranslate[i]=n[this._userLocale]:this._resultTranslate[i]=n.en}if(Object.defineProperty(this,"TRANS",{value:new Translation(this._resultTranslate),writable:!1}),void 0===e)throw new Error("Не передан тип формы");if(-1===[RegistrationModel.FORM_2_P,RegistrationModel.FORM_4_P].indexOf(e))throw new Error("Неверный формат формы: "+e);if(t=t||RegistrationModel.PROJECT_BO,window.location.search.indexOf("regPlatform=fx")>=0&&(t=RegistrationModel.PROJECT_FX),window.location.search.indexOf("regPlatform=bo")>=0&&(t=RegistrationModel.PROJECT_BO),-1===[RegistrationModel.PROJECT_BO,RegistrationModel.PROJECT_FX].indexOf(t))throw new Error("Неверное имя проекта: "+t);ValueBuilder.call(this,e,t),this._hosts=utils.getHostNames(),this._linkToRegistration=this._hosts.API,this._id=id++,this._typeForm=e,this._fetchInProgress=!1,this.defaultBehaviorAfterRegistration=function(e){window.top.location.href=this._hosts.PLATFORM+"platform/tutorial"},this._behaviorAfterRegistration=this.defaultBehaviorAfterRegistration,this.setBehaviorAfterRegistration=function(e){if(void 0===e||!utils.isFunction(e))throw new Error("Аргумент не функция");this._behaviorAfterRegistration=e},this._errorHandler=function(e){this._fetchInProgress=!1,alert(e)},this.setErrorHandler=function(e){if(void 0===e||!utils.isFunction(e))throw new Error("Аргумент не функция");this._errorHandler=e},this.execute=function(){this._fetchInProgress||(this._fetchInProgress=!0,this._typeForm===RegistrationModel.FORM_2_P?this._executeForm2p():this._typeForm===RegistrationModel.FORM_4_P&&this._executeForm4p())},this._bindAdditionalFields=function(e,t){var r=Object.keys(this._additionalFields);return 0!==r.length&&r.forEach(function(r){t[r]=e[r]}),t},this._handleErrorMessage=function(e){this._fetchInProgress=!1,!function(e){for(var t in translates)if(t===e)return!0}(e[0].code)?this._errorHandler(this.TRANS.get("registration_error")):this._errorHandler(this.TRANS.get(e[0].code))},this._executeForm2p=function(e){function r(e){var r=t===RegistrationModel.PROJECT_FX?"fx":"bo";utils.sendByFetch(e._linkToRegistration,n,r,function(t){t.data?e._behaviorAfterRegistration(t):t.errors?e._handleErrorMessage(t.errors):t.captcha?e.execute(!0):e._errorHandler(t.errors)})}var i=this;if(this._rules)if(this._email.length&&this._password.length){window.regCounter++,e=e||!1;var n={data:{email:this._email,password:this._password,currency:this._currency,timezone:this._timezone},list:["data"]};if(e&&void 0===window.firePopup){var a=document.createElement("script");a.src=this._hosts.CDN+"lands/common/components/popup/build/js/app.bundle.min.js",a.async=!0,a.defer=!0,a.onload=function(){window.popupController()},document.body.appendChild(a);var s=document.createElement("link");s.href=this._hosts.CDN+"lands/common/components/popup/build/css/app.bundle.min.css",s.type="text/css",s.rel="stylesheet",document.body.appendChild(s)}if(e&&"undefined"==typeof grecaptcha){var o=document.createElement("div");o.dataset.sitekey="6Lc5ACgTAAAAABL3s8j9VkkUn4Engv4QtdCLd9qI",o.dataset.popupIsNested=!0,o.dataset.callback="captchaCallback",o.classList.add("g-recaptcha"),o.classList.add("popup--hidden"),o.id="g-recaptcha",matchMedia("(max-width: 250px)").matches?(alert("max 250"),o.style.transform="scale(0.6)"):matchMedia("(max-width: 310px)").matches&&(alert("max 310"),o.style.transform="scale(0.75)"),document.body.appendChild(o);var l=document.createElement("script");l.src="https://www.google.com/recaptcha/api.js",l.async=!0,l.defer=!0,document.body.appendChild(l),n.g_captcha_token=""}if(e)var u=setInterval(function(){"undefined"!=typeof grecaptcha&&void 0!==window.firePopup&&(firePopup("#g-recaptcha"),clearInterval(u))},100);if(window.captchaCallback=function(e){n.g_captcha_token=e,closePopup("#g-recaptcha"),grecaptcha.reset()},n=this._bindAdditionalFields(this._additionalFields,n),e)var d=setInterval(function(){void 0!==n.g_captcha_token&&""!==n.g_captcha_token&&"undefined"!=typeof grecaptcha&&(console.log(n.g_captcha_token),r(i),n.g_captcha_token="",console.log(n.g_captcha_token),clearInterval(d))},100);else r(i)}else this._errorHandler(this.TRANS.get("empty_fields"));else this._errorHandler(this.TRANS.get("accept_rules_required"))},this._executeForm4p=function(){if(this._rules)if(this._email.length&&this._password.length&&this._name.length&&this._phone.length){var e={data:{email:this._email,password:this._password,language:this._language,currency:this._currency,name:this._name,surname:this._surname,phone:this._phone,timezone:this._timezone},list:["data"]};e=this._bindAdditionalFields(this._additionalFields,e);var r=this,i=t===RegistrationModel.PROJECT_FX?"fx":"bo";utils.sendByFetch(r._linkToRegistration,e,i,function(e){e.data?r._behaviorAfterRegistration(e):e.errors?r._handleErrorMessage(e.errors):e.captcha?r.execute(!0):r._errorHandler(e.errors)})}else this._errorHandler(this.TRANS.get("empty_fields"));else this._errorHandler(this.TRANS.get("accept_rules_required"))}};Object.defineProperty(RegistrationModel,"FORM_2_P",{value:"FORM_2_P",writable:!1}),Object.defineProperty(RegistrationModel,"FORM_4_P",{value:"FORM_4_P",writable:!1}),Object.defineProperty(RegistrationModel,"PROJECT_BO",{value:"PROJECT_BO",writable:!1}),Object.defineProperty(RegistrationModel,"PROJECT_FX",{value:"PROJECT_FX",writable:!1});var translates={user_already_exist:{en:"This user already exists",ru:"Пользователь уже существует",pt:"Este usuário já existe",es:"Este usuario ya existe",th:"มีชื่อผู้ใช้งานนี้แล้ว",id:"Pengguna ini sudah ada",ms:"Pengguna telah wujud",tr:"Bu kullanıcı zaten mevcut",vi:"Người dùng này đã tồn tại"},registration_error:{en:"An error occurred while registering",ru:"Произошла ошибка при регистрации",pt:"Ocorreu um erro durante o cadastro",es:"Ha ocurrido un error durante el registro",th:"พบข้อผิดพลาด ระหว่างการลงทะเบียน",id:"Kesalahan terjadi saat mendaftar",ms:"Ralat berlaku semasa mendaftar",tr:"Kayıt aşamasında bir hata oluştud",vi:"Đã có lỗi xảy ra khi đăng ký"},invalid_email:{en:"Incorrect e-mail address",ru:"Неправильно введён адрес почты",pt:"Endereço de e-mail incorreto",es:"Dirección de e-mail incorrecta",th:"อีเมล์ไม่ถูกต้อง",id:"Alamat email salah",ms:"Alamat e-mel salah",tr:"Geçersiz e-posta adresi",vi:"Địa chỉ email không đúng"},password_length_restriction:{en:"The password must contain more than 4 characters",ru:"Пароль должен быть больше 4 символов",pt:"A senha deve conter mais de 4 caracteres",es:"La contraseña debe contener más de 4 caracteres",th:"รหัสผ่าน จะต้องประกอบไปด้วยตัวอักษร มากกว่า 4 ตัว",id:"Kata sandi harus mengandung lebih dari 4 karakter",ms:"Kata laluan harus melebihi 4 aksara",tr:"Şifre 4 karakterden uzun olmalıdır",vi:"Mật khẩu phải có trên 4 ký tự"},empty_field:{en:"The field should not be empty",ru:"Поле не должно быть пустым",pt:"Esse campo não deve ficar em branco",es:"Este campo no puede quedar vacío",th:"ช่องไม่สมควรว่างเปล่า",id:"Bidang tidak boleh kosong",ms:"",tr:"Alan boş bırakılmamalı"},empty_fields:{en:"Please fill in all the fields",ru:"Пожалуйста, заполните все поля",pt:"Por favor, preencha todos os campos",es:"Por favor, complete todos los campos",th:"กรุณา ใส่ข้อมูลในช่องทั้งหมด",id:"Silahkan isi semua pertanyaan",ms:"",tr:"Lütfen, tüm alanları doldurunuz"},accept_rules_required:{en:"To continue, you have to agree to the rules",ru:"Для продолжения необходимо согласиться с правилами",pt:"Você tem que aceitar os termos para continuar",es:"Debe aceptar los términos para continuar",th:"คุณจำเป็นต้องยอมรับเงื่อนไขเพื่อดำเนินการต่อ",id:"Anda harus menyetujui persyaratan untuk melanjutkan",ms:"",tr:"Devam etmek için şartları kabul etmelisin"},register_success:{en:"Congratulations! You have successfully completed registration",ru:"Поздравляем! Вы успешно зарегистрированы.",pt:"Parabéns! Você completou o registro com sucesso.",es:"¡Felicitaciones! Ha completado la inscripción exitosamente",th:"ยินดีด้วย! คุณทำการลงทะเบียนเสร็จสมบูรณ์",id:"Selamat! Anda berhasil menyelesaikan pendaftaran",ms:"",tr:"Tebrikler! Kayıt işlemini başarıyla tamamladınız"},plain_preloader_text:{en:"Wait a few seconds",ru:"Подождите несколько секунд",pt:"Espere alguns segundos",es:"Espere unos segundos",th:"กรุณาคอยสักสองสามวินาที",id:"Silahkan menunggu beberapa detik",ms:"",tr:"Lütfen birkaç saniye bekleyin"},start_of_deal:{en:"Trade<br> start",ru:"Начало<br> сделки",pt:"Início da<br> transação",es:"",th:"เริ่่มการซื้อขาย",id:"Mulai<br> transaksi",ms:"",tr:"İşlem<br>başlangıcı"},end_of_deal:{en:"End of<br> trade",ru:"Конец<br> сделки",pt:"Fim da<br> transação",es:"",th:"การซื้อขายสิ้นสุดลง",id:"Akhir<br> transaksi",ms:"",tr:"İşlem <br> bitişi"},time:{en:"Time",ru:"Время",pt:"Tempo",es:"Tiempo",th:"เวลา",id:"Waktu",ms:"",tr:"Zaman"},curs:{en:"Exchange Rate",ru:"Курс",pt:"Câmbio",es:"Tasa",th:"อัตรา",id:"Nilai",ms:"",tr:"Oran"}};RegistrationModel.prototype=Object.create(ValueBuilder.prototype);for(var key in eventMixin)RegistrationModel.prototype[key]=eventMixin[key];var RegistrationModelsSynchronization=function(){this._models=[]};RegistrationModelsSynchronization.prototype.addForm=function(e){if(!(e instanceof RegistrationModel))throw new Error("Переданная форма не является объектом RegistrationModel");this._models.push(e);var t=this;e.on("change",function(e){for(var r=0;r<t._models.length;r++)t._models[r]._id!==e._id&&t._models[r].setEmailDOM(e._email).setPasswordDOM(e._password).setNameDOM(e._name).setSurnameDOM(e._surname).setPhoneDOM(e._phone).setCurrencyDOM(e._currency).setRulesDOM(e._rules)})};